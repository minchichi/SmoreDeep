<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/Sly/1.6.1/sly.min.js"></script>
<link rel="icon" href="images/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="assets/css/style_min.css">
<!-- jQuery ì¶”ê°€ -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<title>S'MoreDeep</title>
</head>
<body>
	<div th:replace="~{/header :: body}"></div>

	<div class="chat-container">
		<div class="chat-box" id="chat-box">
			<div class="message bot-message">ì•ˆë…•í•˜ì„¸ìš” ìŠ¤ëª¨ì–´ë”¥ ì±—ë´‡ì…ë‹ˆë‹¤. ì›í•˜ì‹œëŠ” ê°•ì˜
				ìŠ¤íƒ€ì¼ì´ë‚˜ ê´€ì‹¬ë¶„ì•¼ë¥¼ ë§í•´ì£¼ì‹œë©´ ê°•ì˜ë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!</div>

			

			<div class="course-message">
				<div class="product-list" id="course-list"></div>
			</div>


			
		</div>
		<!-- ì‹œì‘ ì„ íƒ: ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë“œ or ì§ì ‘ì…ë ¥ -->
			<div class="quick-buttons" id="start-buttons">
				<button class="quick-button" onclick="startCategoryFlow()">ì¹´í…Œê³ ë¦¬
					ì„ íƒ</button>
				<button class="quick-button" onclick="unlockInput()">ì§ì ‘
					ì…ë ¥í•˜ê¸°</button>
			</div>

			<!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ë‹¨ê³„ -->
			<div class="quick-buttons" id="step-category" style="display: none;">
				<button class="quick-button" onclick="selectCategory('í”„ë¡ íŠ¸ì—”ë“œ')">í”„ë¡ íŠ¸ì—”ë“œ</button>
				<button class="quick-button" onclick="selectCategory('ë°±ì—”ë“œ')">ë°±ì—”ë“œ</button>
				<button class="quick-button" onclick="selectCategory('í”„ë¡œê·¸ë˜ë°')">í”„ë¡œê·¸ë˜ë°</button>
			</div>

			<!-- ë‚œì´ë„ ì„ íƒ ë‹¨ê³„ -->
			<div class="quick-buttons" id="step-level" style="display: none;">
				<button class="quick-button" onclick="selectLevel('ì…ë¬¸')">ì…ë¬¸</button>
				<button class="quick-button" onclick="selectLevel('ì´ˆê¸‰')">ì´ˆê¸‰</button>
				<button class="quick-button" onclick="selectLevel('ì¤‘ê¸‰ ì´ìƒ')">ì¤‘ê¸‰
					ì´ìƒ</button>
			</div>

			<!-- ê°•ì˜ì‹œê°„ ì„ íƒ ë‹¨ê³„ -->
			<div class="quick-buttons" id="step-time" style="display: none;">
				<button class="quick-button" onclick="selectTime('1ì‹œê°„ ë¯¸ë§Œ')">1ì‹œê°„
					ë¯¸ë§Œ</button>
				<button class="quick-button" onclick="selectTime('1ì‹œê°„ ì´ìƒ')">1ì‹œê°„
					ì´ìƒ</button>
				<button class="quick-button" onclick="selectTime('3ì‹œê°„ ì´ìƒ')">3ì‹œê°„
					ì´ìƒ</button>
				<button class="quick-button" onclick="selectTime('5ì‹œê°„ ì´ìƒ')">5ì‹œê°„
					ì´ìƒ</button>
			</div>
		<div class="chat-input">
			<input type="text" id="user-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
			<button onclick="sendMessage()">ì „ì†¡</button>
		</div>
		
	</div>

	<div th:replace="~{/footer :: body}"></div>

	<script>
let selectedCategory = "";
let selectedLevel = "";
let selectedTime = "";
let inputUnlocked = false;

function addBotMessage(msg) {
  $("#chat-box").append(`<div class="message bot-message">${msg}</div>`);
  $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
}

function startCategoryFlow() {
  $(".quick-buttons").hide();
  selectedCategory = "";
  selectedLevel = "";
  selectedTime = "";
  addBotMessage("ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
  $("#step-category").show();
}

function selectCategory(category) {
  selectedCategory = category;
  $("#step-category").hide();
  addBotMessage("ë‚œì´ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
  $("#step-level").show();
}

function selectLevel(level) {
  selectedLevel = level;
  $("#step-level").hide();
  addBotMessage("ê°•ì˜ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
  $("#step-time").show();
}

function selectTime(time) {
  selectedTime = time;
  $("#step-time").hide();
  addBotMessage("ì„ íƒí•œ ì¡°ê±´ì„ ë°”íƒ•ìœ¼ë¡œ ê°•ì˜ë¥¼ ì¶”ì²œ ì¤‘ì…ë‹ˆë‹¤...");
  const combined = `${selectedCategory} ${selectedLevel} ${selectedTime} ì¶”ì²œ`;
  sendQuickMessage(combined);
}

function unlockInput() {
  inputUnlocked = true;
  $("#user-input").prop("disabled", false).focus();
  $(".quick-buttons").hide();
}

function sendMessage() {
  const msg = $("#user-input").val().trim();
  if (!msg) return;
  $("#user-input").val("");
  sendToServer(msg);
}

function sendQuickMessage(text) {
  $("#user-input").val(text);
  sendMessage();
}

function sendToServer(text) {
  $.ajax({
    url: "/chat/recommend",
    type: "POST",
    contentType: "application/json",
    data: JSON.stringify({ input: text }),
    success: function (data) {
      displayRecommendedCourses(data.results);
    },
    error: function () {
      addBotMessage("âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  });
}

function displayRecommendedCourses(data) {
  $(".product-list").empty();
  data.forEach((title, idx) => {
    const card = `
      <div class="one-product">
        <div class="thumb">
          <img src="images/thumb${(idx % 3) + 1}.png" alt="">
        </div>
        <div class="info">
          <div class="title">${title}</div>
          <div class="sub">
            <div class="date">GPT ì¶”ì²œ ê°•ì˜</div>
            <div class="positive">ğŸ‘ ì¶”ì²œ</div>
          </div>
        </div>
      </div>`;
    $(".product-list").append(card);
  });

  const sly = new Sly(".course-message", {
    horizontal: 1,
    mouseDragging: 1,
    touchDragging: 1
  }).init();

  addBotMessage("ë” ìì„¸í•œ ì¶”ì²œì„ ì›í•˜ì‹œë©´ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜, ë‹¤ì‹œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
  const footerBtns = `
    <div class="quick-buttons">
      <button class="quick-button" onclick="unlockInput()">ì§ì ‘ ì…ë ¥í•˜ê¸°</button>
      <button class="quick-button" onclick="startCategoryFlow()">ë‹¤ì‹œ ì¹´í…Œê³ ë¦¬ ì„ íƒí•˜ê¸°</button>
    </div>`;
  $("#chat-box").append(footerBtns);
  $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
}
</script>

</body>
</html>